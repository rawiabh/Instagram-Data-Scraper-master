$=jQuery;var $document=$(document),is_online=window.navigator.onLine,htaccess=$.trim($("#htaccess").val()),$btnExportExcel=$("#btnExport"),$loadingContainer=$(".progress-bar"),totalRequestUrl=0,currentMasterIndex=1,currentMasterProgress=0,logInfo=!0,isFilter=!1,is_chart_created=(htaccess=$.trim($("#is_htaccess_enable").val()),!1),navBarForm=$(".form-inline"),booClose=$(".close"),keyContainer=["#digitaslbi"],currentIndex=0,chkOpt=$("input[name='infoopt']:checked").val(),Config={action:"account",infoFullMin:chkOpt,urlRequest:"includes/AjaxServices.php",userAgentStatus:is_online,btnSearch:"#btnSearch",txtSearch:"#txtSearch",queryFormTemplate:"#query-form-template",searchFormContainer:"#search-form-section",searchFormChartContainer:"#search-form-chart-section",lblCountSearchAccounts:"#CountSearchAccounts .badge.badge-pill",lblCountSearchHashtags:"#CountSearchHashtags .badge.badge-pill",lblSumOfTotalLikes:"#SumOfTotalLikes .badge.badge-pill",lblSumOfTotalComments:"#SumOfTotalComments .badge.badge-pill",lblSumOfTotalShare:"#SumOfTotalShare .badge.badge-pill",lblSumOfTotalPosts:"#SumOfTotalPosts .badge.badge-pill",chartTemplate:"#chart-template",offlineMsg:"Please enable Internet Connection. You are off-line",queryAccounts:1,queryHashtags:1,queryLikes:1,queryComments:1,queryKeywords:1,queryPosts:1,getItem:function(t){return this[t].toString()?(_l("Item found: "+t),this[t].toString()):(_l("Item not found: "+t),!1)},setItem:function(t,e){this[t]&&(_l("Item found and set value: "+t+" : "+e),this[t]=e)}},_l=function(t){!0===logInfo&&console.log(t)};$(document).ajaxError(function(t,e,n,s){errStr="",errStr+='<div class="alert alert-danger alert-dismissable">',errStr+='  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>',errStr+="  <strong>Error in Request: </strong> "+s,errStr+="</div>",$(".error-handling .container-fluid").html(errStr).parent().removeClass("hide")});var stateProgress=function(){_l("currentMasterIndex: "+currentMasterIndex),_l("currentMasterProgress: "+currentMasterProgress)};function fnExcelReport(t){var e=document.getElementById(t),n="<table border='2px'>";for(j=0;j<1;j++)n+="<tr bgcolor='#87AFC6'>"+e.rows[j].innerHTML+"</tr>";for(j=1;j<e.rows.length;j++)n+="<tr>"+e.rows[j].innerHTML+"</tr>";return n=(n=(n=(n+="</table>").replace(/<A[^>]*>|<\/A>/g,"")).replace(/<img[^>]*>/gi,"")).replace(/<input[^>]*>|<\/input>/gi,""),"data:application/vnd.ms-excel, "+encodeURIComponent(n)}var Instagram=function(){this.stateError=!1,this.txtProgressState=0,this.info=[],this.urlInstagram="https://www.instagram.com",this.urlInstagramNext=null,this.InstaJSON=null,this.currentIndex=0,this.currentIndexPost=0,this.isSearchingForNext=!1,this.errorContainer=$(".user-error"),this.infoContainer=$(".user-info"),this.tableWrapper=$("#search-account-table"),this.tableContentWrapper=$("#search-account-table.table-striped tbody"),this.txtIndicator=$(".txt-progress"),this.sendRequestUrl=Config.getItem("urlRequest"),this.infoFullMin=Config.getItem("infoFullMin")};Instagram.prototype.setAccount=function(){if(!1===this.isSearchingForNext&&(this.info=[],this.info.Biography=this.InstaJSON.user.biography,this.info.UserName=this.InstaJSON.user.username,this.info.FullName=this.InstaJSON.user.full_name,this.info.Posts=this.InstaJSON.user.media.count,this.info.Followers=this.InstaJSON.user.followed_by.count,this.info.Following=this.InstaJSON.user.follows.count,this.info.AccountHref=this.urlInstagram+"/"+this.InstaJSON.user.username),"min"!=this.infoFullMin){var t=Math.ceil(this.info.Posts/12);this.eventHandler("Likes & Comments: "+this.currentIndexPost+"/"+t+", "+this.info.FullName),this.txtProgressState=Math.ceil(100*this.currentIndexPost)/t;var e=this.InstaJSON.user.media.nodes,n=[],s=[],o=[],i=0,a=0,r=0;$.each(e,function(t,e){n.push(e.likes.count),s.push(e.comments.count),o.push(e.video_views?e.video_views:0)}),$.each(n,function(){i+=parseInt(this)||0}),$.each(s,function(){a+=parseInt(this)||0}),$.each(o,function(){r+=parseInt(this)||0}),!1===this.isSearchingForNext?(this.info.TotalLikes=i,this.info.TotalComments=a,this.info.TotalViews=r):(this.info.TotalLikes=parseInt(this.info.TotalLikes)+i,this.info.TotalComments=parseInt(this.info.TotalComments)+a,this.info.TotalViews=parseInt(this.info.TotalViews)+r),!0===this.InstaJSON.user.media.page_info.has_next_page?(this.urlInstagramNext=e[e.length-1].id,this.currentIndexPost+=1,this.isSearchingForNext=!0):(this.currentIndexPost=1,this.isSearchingForNext=!1)}void 0===this.info.TotalLikes&&(this.info.TotalLikes=0),void 0===this.info.TotalComments&&(this.info.TotalComments=0),void 0===this.info.TotalViews&&(this.info.TotalViews=0)},Instagram.prototype.buildViews=function(){var t="";return t+='<tr class="info-row">',t+='<td><input class="tbl-chk" type="checkbox"></td>',t+='<td><a target="_blank" href="'+this.info.AccountHref+'">'+this.info.UserName+"</a></td>",t+="<td>"+this.info.Biography+"</td>",t+="<td>"+this.info.Followers+"</td>",t+="<td>"+this.info.Following+"</td>",t+="<td>"+this.info.Posts+"</td>",t+="<td>"+this.info.TotalLikes+"</td>",t+="<td>"+this.info.TotalComments+"</td>",t+="<td>"+this.info.TotalViews+"</td>",t+="<td>",t+='<a data-placement="top" data-toggle="tooltip" title="Edit">',t+='<button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit"><span class="glyphicon glyphicon-pencil"></span></button>',t+="</a> ",t+='<a data-placement="top" data-toggle="tooltip" title="Delete">',t+='<button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete"><span class="glyphicon glyphicon-trash"></span></button>',t+="</a>",t+="</td>",t+="</tr>"},Instagram.prototype.errorHandler=function(t){this.errorContainer.html(t)},Instagram.prototype.eventHandler=function(t,e){void 0===e?(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid green"}),this.infoContainer.eq(this.currentIndex).html(t)):(this.txtIndicator.eq(this.currentIndex).css({width:this.txtProgressState+"%","border-top":"2px solid red"}),this.infoContainer.eq(this.currentIndex).removeClass("label-info").addClass(e).html(t))},Instagram.prototype.initNow=function(t,e){var n=this;return e||(e={iUrl:t,request_action:"search_account"}),$.post(n.sendRequestUrl,e,function(t,e,s){var o=0;if(window._sharedData.error)return n.stateError=!0,n.errorHandler(window._sharedData.error),o=Math.floor(currentMasterIndex/totalRequestUrl*100),currentMasterProgress=o,stateProgress(),currentMasterIndex++,!1;if(n.InstaJSON=window._sharedData.entry_data.ProfilePage.shift(),!0===n.InstaJSON.user.is_private)return n.eventHandler("This is Private account: "+n.InstaJSON.user.full_name,"label-danger"),!1;if(n.stateError=!1,n.setAccount(),!0===n.isSearchingForNext){var i={keyword:n.info.UserName,request_action:"search_account",max_id:n.urlInstagramNext};n.initNow(n.info.UserName,i)}else currentMasterIndex++,o=Math.floor(currentMasterIndex/totalRequestUrl*100),n.isSearchingForNext=!1,n.currentIndexPost=1,n.txtProgressState=0,n.eventHandler("Likes & Comments Done..."+n.info.FullName,"label-success"),_l("Current Index "+n.currentIndex),_l("totalRequestUrl "+totalRequestUrl),_l("Current% "+o),currentMasterProgress=o,stateProgress(),n.tableContentWrapper.append(n.buildViews())})},$document.ready(function(){$("input[name='infoopt']").on("change",function(){chkOpt=$(this).val(),Config.setItem("infoFullMin",chkOpt)}),$("[data-toggle=tooltip]").tooltip(),(t=jQuery).fn.flash=function(e){void 0===e?t(".container.preloader").addClass("hide"):t(".container.preloader").removeClass("hide").find(".progress-bar.progress-bar-striped").html(e)};var t;$(".wow").jQCloud([{text:"#Lovely",weight:10},{text:"#Good",weight:11},{text:"#Excellent",weight:12},{text:"#Wowmade",weight:13},{text:"#wow",weight:14},{text:"#Philadelphia",weight:15},{text:"#NewDone",weight:16},{text:"#Best",weight:17}],{shape:"elliptic",autoResize:!0,height:350});$(".oh").jQCloud([{text:"#SoBad",weight:21},{text:"#Nope",weight:22},{text:"#DoNotWorks",weight:23},{text:"#Useless",weight:24},{text:"#SoPoor",weight:25},{text:"#AnotherBad",weight:26},{text:"#ServiceOff",weight:27},{text:"#Ban",weight:28}],{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c"],shape:"elliptic",autoResize:!0,height:350});var e=function(){};e.prototype.setOfflineMode=function(){if(this.userAgentStatus==fasle){var t=$("#offline-template").html();$(".wrapper").html(t)}},$(document).on("click","a.download",function(){_l("Download triggered....");var t=$(this),e=fnExcelReport(t.data("id"));t.attr("download","ExcelExport-"+(new Date).getTime()+".xls").attr("href",e).attr("target","_blank")});var n=$(Config.getItem("txtSearch"));n.typeahead({multiple:!0,source:keyContainer,autoSelect:!0,minLength:0,items:20,showHintOnFocus:!0,dupChecker:!0}),n.change(function(){var t=n.typeahead("getActive");t&&(t.name,n.val())}),$document.ajaxStart(function(){$("body").flash("Please wait...request in progress")}).ajaxStop(function(){$("body").flash()}),booClose.modal("hide"),$("body").tooltip({selector:"[rel=tooltip]",trigger:"hover"}),$document.delegate('*[data-toggle="lightbox"]',"click",function(t){t.preventDefault(),$(this).ekkoLightbox()});function s(){return"#"+("000000"+(16777215-Math.floor(16777216*Math.random())).toString(16)).substr(-6)}function o(t){(new Date).getTime();CanvasJS.addColorSet("customColorSet",[s(),s(),s(),s(),s(),s()]),new CanvasJS.Chart(t.chartId,{animationDuration:800,animationEnabled:!0,backgroundColor:"transparent",colorSet:"customColorSet",theme:"theme2",legend:{fontFamily:"calibri",fontSize:14,horizontalAlign:"left",verticalAlign:"center",itemTextFormatter:function(t){return t.dataPoint.name+": "+t.dataPoint.y}},title:{dockInsidePlotArea:!0,fontSize:20,fontWeight:"normal",horizontalAlign:"center",verticalAlign:"center",text:t.count},toolTip:{cornerRadius:0,fontStyle:"normal"},data:[{innerRadius:"80%",radius:"90%",legendMarkerType:"square",showInLegend:!0,startAngle:90,type:"doughnut",dataPoints:[{y:t.likes,name:"Likes"},{y:t.comments,name:"Comments"},{y:t.keywords,name:"Keywords"}]}]}).render(),is_chart_created=!0}$.sum=function(t){var e=0;return $.each(t,function(t,n){e+=n}),e};var i=function(t){return this.filterKeywords=t.filterKeywords,this.keyWordsGroupCountValue=[],this.container=t.container||!1,this.keyword=t.keyword||!1,this.template=t.template||!1,this.callback=t.callback||!1,this.viewData={},this.chartOptions={},this.sumOfTotalLikes=t.sumOfTotalLikes,this.sumOfTotalComments=t.sumOfTotalComments,this.sumOfTotalShare=t.sumOfTotalShare,this.sumOfTotalPosts=t.sumOfTotalPosts,this.src="",this.caption="",this.like=0,this.comment=0,this.name="",this.count=0,this.tblSummery=[],this.keywordSummery=[],this.imgSrcTemplate=[],this.setIndex=0,this.requestUrl=Config.getItem("urlRequest"),this.dataJson={},this.isNextOn=!1,this.sumOfCount=0,this.sumOfLikes=0,this.sumOfPosts=0,this.sumOfComments=0,this._self=this,this.nextId=!1,this.maxRequestNo=4,this.requestRecursiveCycle=!0,this.limitRequest=0,this.action=t.action?t.action:"search_info",this};i.prototype.initStart=function(){var t=this;return $.post(t.requestUrl,{keyword:t.keyword,next:t.nextId,request_action:t.action},function(e){if(window._sharedData.error)return!1;e=window._sharedData.entry_data.ProfilePage.shift(),_l(e),t.dataJson=e,!0===t.dataJson.tag.media.page_info.has_next_page?(t.isNextOn=!0,t.nextId=t.dataJson.tag.media.page_info.end_cursor):t.isNextOn=!1,t.buildMediaPost(e),t.limitRequest<1&&t.buildTopPostMedia(e),t.onCallNextRequest()})},i.prototype.findHashtags=function(t){if(t){return result=t.match(/\B\#\w\w+\b/g),result||[]}return[]},i.prototype.keyWordsGroupCount=function(t){var e=this;t.forEach(function(t,n){e.keyWordsGroupCountValue[t]?e.keyWordsGroupCountValue[t].push(1):e.keyWordsGroupCountValue[t]=[1]})},i.prototype.buildTemplateView=function(){var t=this,e="chart-view-"+(new Date).getTime();this.keyWordsGroupCount(keyContainer);var n=1,s=[];Object.keys(this.keyWordsGroupCountValue.sort()).forEach(function(t,e){s.push({name:t,val:this.keyWordsGroupCountValue[t].length})},this),s.sort(function(t,e){return e.val-t.val}),s.forEach(function(e,s){t.keywordSummery.push({sno:n++,keyword:e.name,key_count:e.val})},this),this.viewData={container:e,title:this.name,"table-summery":this.tblSummery,"key-table-summery":this.keywordSummery,"img-thumbs":this.imgSrcTemplate},this.container.append(Mustache.render(this.template,this.viewData)),this.chartOptions={chartId:e,count:this.count,likes:this.like,comments:this.comment,keywords:Object.keys(this.keyWordsGroupCountValue).length}},i.prototype.buildMediaPost=function(t){var e=this;e.name=t.tag.name,e.count=t.tag.media.count,e.sumOfCount+=parseInt(e.count)||0,$.each(t.tag.media.nodes,function(t,n){e.src=n.thumbnail_src,e.caption=n.caption,e.comment+=parseInt(n.comments.count)||0,e.like+=parseInt(n.likes.count)||0,e.findHashtags(n.caption).forEach(function(t){e.filterKeywords.push(t)},this)})},i.prototype.buildTopPostMedia=function(t){var e=this;$.each(t.tag.top_posts.nodes,function(t,n){var s=t+1;e.src=n.thumbnail_src,e.caption=n.caption,e.comment+=parseInt(n.comments.count)||0,e.like+=parseInt(n.likes.count)||0,e.findHashtags(n.caption).forEach(function(t){e.filterKeywords.push(t)},this),!0===n.is_video?e.imgSrcTemplate.push({img_src:e.src,likes_img:n.likes.count,comments_img:n.comments.count,video_views:parseInt(n.video_views)||0}):e.imgSrcTemplate.push({img_src:n.thumbnail_src,likes_img:n.likes.count,comments_img:n.comments.count}),e.tblSummery.push({no:s,posts:n.caption,likes_count:n.likes.count,comments_count:n.comments.count})})},i.prototype.buildSummarizeCount=function(t){this.sumOfLikes+=this.like,this.sumOfComments+=this.comment,this.sumOfCount+=this.count,this.sumOfPosts+=this.count,this.sumOfTotalLikes.text(parseInt(this.sumOfTotalLikes.text())+this.sumOfLikes),this.sumOfTotalComments.text(parseInt(this.sumOfTotalComments.text())+this.sumOfComments),this.sumOfTotalShare.text(parseInt(this.sumOfTotalShare.text())+Object.keys(this.keyWordsGroupCountValue).length),this.sumOfTotalPosts.text(parseInt(this.sumOfTotalPosts.text())+this.sumOfPosts)},i.prototype.onCallNextRequest=function(){this.limitRequest++,this.isNextOn&&this.requestRecursiveCycle&&this.limitRequest<this.maxRequestNo?this.initStart():(this.buildTemplateView(),this.buildSummarizeCount(),this.callback(this.chartOptions))};new e;var a=parseInt(Config.getItem("queryHashtags"))-1,r=parseInt(Config.getItem("queryAccounts"))-1;$(Config.getItem("btnSearch")).click(function(t){var n=$(Config.getItem("queryFormTemplate")).html();Mustache.parse(n);var s=$(Config.getItem("searchFormContainer")),l=$(Config.getItem("txtSearch")).val();if(l){new e;var u,h=l.split(" "),c=0;$.each(h,function(t,e){if(0===h[t].indexOf("#")){u=Mustache.render(n,{action:"hashtag",value:e,indicator:"txt-progress-none",input_action:"txt-insta-none",user_indicator:"user-info-none"}),s.append(u),a++;var l={filterKeywords:keyContainer,sumOfTotalLikes:$(Config.getItem("lblSumOfTotalLikes")),sumOfTotalComments:$(Config.getItem("lblSumOfTotalComments")),sumOfTotalShare:$(Config.getItem("lblSumOfTotalShare")),sumOfTotalPosts:$(Config.getItem("lblSumOfTotalPosts")),container:$(Config.getItem("searchFormChartContainer")),keyword:e.replace("#","")||"digitaslbi",template:$(Config.getItem("chartTemplate")).html(),action:"search_info",callback:o};new i(l).initStart()}if(0===h[t].indexOf("@")){if(u=Mustache.render(n,{action:"instagram",value:e,indicator:"txt-progress",input_action:"txt-insta",user_indicator:"user-info"}),s.append(u),r++,!is_online)return void alert(Config.getItem("offlineMsg"));if($.trim(e)){_l(e),e=e.replace(/\@/,"",e),isFilter=!0;var m=new Instagram;m.currentIndex=c,m.eventHandler("Getting data, please wait...."),m.initNow(null,{keyword:e,request_action:"search_account",next:"false"}).done(function(t){m.stateError&&(m.currentIndexPost=1,m.eventHandler("Error in Instagram profile link, wrong link","label-danger"))})}c++}}),Config.setItem("queryHashtags",a),Config.setItem("queryAccounts",r),$(Config.getItem("lblCountSearchHashtags")).html(a),$(Config.getItem("lblCountSearchAccounts")).html(r)}})});